name: Build LaTeX Resume

on:
  push:
    paths:
      - "**.tex"
      - "**.cls"
      - ".github/workflows/build.yml"

jobs:
  build_latex:
    runs-on: ubuntu-latest
    steps:
      # Checkout
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      # Compile LaTeX
      - name: Compile LaTeX
        uses: xu-cheng/latex-action@v2
        with:
          root_file: main.tex
          latexmk_use_xelatex: true

      # Safe timestamp (Windows compatible)
      - name: Set timestamp
        run: |
          SAFE_DATE=$(date +'%Y-%m-%d-%H-%M-%S')
          echo "SAFE_DATE=$SAFE_DATE" >> $GITHUB_ENV

      # Copy compiled PDF to artifacts folder
      - name: Copy PDF to artifacts
        run: |
          mkdir -p artifacts
          cp main.pdf artifacts/resume-${{ env.SAFE_DATE }}.pdf

      # Commit and push updated PDFs
      - name: Push updated PDF
        run: |
          git config --local user.name "GitHub Actions"
          git config --local user.email "actions@github.com"
          git add .
          git commit -m "[CD] Update resume.pdf" || echo "No changes to commit"
          git push
